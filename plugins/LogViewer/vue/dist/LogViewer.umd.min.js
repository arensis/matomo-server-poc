(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["LogViewer"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["LogViewer"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="plugins/LogViewer/vue/dist/",r(r.s="fae3")}({"19dc":function(t,r){t.exports=e},"8bbf":function(e,r){e.exports=t},a5a2:function(e,t){e.exports=r},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"LogViewer",(function(){return J})),"undefined"!==typeof window){var n=window.document.currentScript,o=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(r.p=o[1])}var i=r("19dc"),l=r("8bbf"),a={class:"logViewer"},c={class:"row"},s={class:"logWriters col s4 m3 l2"},u={class:"severities col s4 m3 l2"},d={class:"col s12 m12 l8"},g=["title","placeholder"],p=["title"],f={class:"useRegExp",style:{"margin-right":"3.5px"}},b=["action"],m=["value"],h=Object(l["createElementVNode"])("input",{type:"hidden",name:"force_api_session",value:"1",style:{"margin-right":"3.5px"}},null,-1),y=["title"],v=["title"],j=Object(l["createElementVNode"])("br",null,null,-1),O={class:"severity"},V={class:"tag"},E={class:"date"},N={class:"date"},w={class:"message"},C=["title","onClick"],S=["title","onClick"],L=["title","onClick"],k=["title","onClick"],x={class:"message"},_={key:0},q={colspan:"5"},A={colspan:"5"},T={class:"loadingPiwik"},R=Object(l["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),D={colspan:"5",class:"paging"};function I(e,t,r,n,o,i){var I=Object(l["resolveComponent"])("Field"),P=Object(l["resolveComponent"])("ContentBlock"),W=Object(l["resolveDirective"])("content-table");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",a,[Object(l["createVNode"])(P,{"content-title":e.translate("LogViewer_LogViewer")},{default:Object(l["withCtx"])((function(){var r,n;return[Object(l["createElementVNode"])("div",c,[Object(l["createElementVNode"])("div",s,[Object(l["createVNode"])(I,{uicontrol:"select",name:"logWriter","model-value":e.selectedLogWriter,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.selectedLogWriter=t,e.update()}),"full-width":!0,options:e.logWriters},null,8,["model-value","options"])]),Object(l["createElementVNode"])("div",u,[Object(l["createVNode"])(I,{uicontrol:"select",name:"selectedSeverity","model-value":e.selectedSeverity,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.selectedSeverity=t,e.update()}),"full-width":!0,options:e.severities},null,8,["model-value","options"])]),Object(l["createElementVNode"])("div",d,[Object(l["withDirectives"])(Object(l["createElementVNode"])("input",{type:"text",class:"search",onKeydown:t[2]||(t[2]=function(t){return e.onSearchKeydown(t)}),title:e.translate("LogViewer_SearchHelp"),"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.query=t}),placeholder:e.translate("LogViewer_SearchPattern"),style:{"margin-right":"3.5px"}},null,40,g),[[l["vModelText"],e.query]]),Object(l["createElementVNode"])("span",{class:"icon-search searchIcon",title:e.translate("General_ClickToSearch"),onClick:t[4]||(t[4]=function(t){return e.update()})},null,8,p),Object(l["createElementVNode"])("div",f,[Object(l["createVNode"])(I,{uicontrol:"checkbox",title:e.translate("LogViewer_UseRegExp"),modelValue:e.useRegExp,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.useRegExp=t})},null,8,["title","modelValue"])]),Object(l["createElementVNode"])("a",{class:"icon-reload",onClick:t[6]||(t[6]=function(t){return e.update()}),style:{"margin-right":"3.5px"}}),Object(l["createElementVNode"])("form",{method:"POST",id:"export",ref:"export",target:"_blank",action:e.exportFormAction},[Object(l["createElementVNode"])("input",{type:"hidden",name:"token_auth",value:e.tokenAuth},null,8,m),h,Object(l["createElementVNode"])("a",{class:"icon-export",onClick:t[7]||(t[7]=function(t){return e.$refs.export.submit()}),title:e.translate("LogViewer_ExportThisSearch","TSV",5e3),style:{"margin-right":"3.5px"}},null,8,y)],8,b),Object(l["createElementVNode"])("a",{class:"icon-info",target:"_blank",href:"https://piwik.org/faq/troubleshooting/faq_115/",rel:"noreferrer noopener",title:e.translate("LogViewer_CurrentLogConfigIs",e.logConfigJson)},null,8,v),j]),Object(l["withDirectives"])(Object(l["createElementVNode"])("table",null,[Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",O,Object(l["toDisplayString"])(e.translate("LogViewer_Severity")),1),Object(l["createElementVNode"])("th",V,Object(l["toDisplayString"])(e.translate("LogViewer_Tag")),1),Object(l["createElementVNode"])("th",E,Object(l["toDisplayString"])(e.translate("General_Date")),1),Object(l["createElementVNode"])("th",N,Object(l["toDisplayString"])(e.translate("LogViewer_RequestId")),1),Object(l["createElementVNode"])("th",w,Object(l["toDisplayString"])(e.translate("LogViewer_Message")),1)])]),Object(l["createElementVNode"])("tbody",null,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.logsWithMessage,(function(t,r){return Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:r},[Object(l["createElementVNode"])("td",{class:Object(l["normalizeClass"])(["severity",{selectable:t.severity}]),title:t.severity?e.translate("LogViewer_ClickToSearchForThis"):"",onClick:function(r){return e.searchSeverity(t.severity)}},Object(l["toDisplayString"])(t.severity||"-"),11,C),Object(l["createElementVNode"])("td",{class:Object(l["normalizeClass"])(["tag",{selectable:t.tag}]),title:t.tag?e.translate("LogViewer_ClickToSearchForThis"):"",onClick:function(r){return e.searchText(t.tag)}},Object(l["toDisplayString"])(t.tag||"-"),11,S),Object(l["createElementVNode"])("td",{class:Object(l["normalizeClass"])(["date",{selectable:t.datetime}]),title:t.datetime?e.translate("LogViewer_ClickToSearchForThis"):"",onClick:function(r){return e.searchDate(t.datetime)}},Object(l["toDisplayString"])(t.datetime||"-"),11,L),Object(l["createElementVNode"])("td",{class:Object(l["normalizeClass"])(["requestId",{selectable:t.requestId}]),title:t.requestId?e.translate("LogViewer_ClickToSearchForThis"):"",onClick:function(r){return e.searchRequestId(t.requestId)}},Object(l["toDisplayString"])(t.requestId||"-"),11,k),Object(l["createElementVNode"])("td",x,Object(l["toDisplayString"])(t.message),1)])})),128)),e.isLoading||0!==(null===(r=e.logs)||void 0===r?void 0:r.length)?Object(l["createCommentVNode"])("",!0):(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",_,[Object(l["createElementVNode"])("td",q,Object(l["toDisplayString"])(e.translate("General_SearchNoResults")),1)])),Object(l["withDirectives"])(Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("td",A,[Object(l["createElementVNode"])("span",T,[R,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_Loading")),1)])])],512),[[l["vShow"],e.isLoading]]),Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("td",D,[Object(l["withDirectives"])(Object(l["createElementVNode"])("span",{id:"prev",class:"previous",onClick:t[9]||(t[9]=function(t){return e.previousPage()})},[Object(l["createElementVNode"])("a",{class:"btn",onClick:t[8]||(t[8]=Object(l["withModifiers"])((function(){}),["prevent"]))},[Object(l["createElementVNode"])("span",null,"« "+Object(l["toDisplayString"])(e.translate("General_Previous")),1)])],512),[[l["vShow"],!(e.page<1)]]),Object(l["withDirectives"])(Object(l["createElementVNode"])("span",{id:"next",class:"next pointer",onClick:t[11]||(t[11]=function(t){return e.nextPage()})},[Object(l["createElementVNode"])("a",{class:"btn",onClick:t[10]||(t[10]=Object(l["withModifiers"])((function(){}),["prevent"]))},[Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e.translate("General_Next"))+" »",1)])],512),[[l["vShow"],!((null===(n=e.logs)||void 0===n?void 0:n.length)<1)]])])])])],512),[[W]])])]})),_:1},8,["content-title"])])}var P=r("a5a2");function W(e,t){return U(e)||G(e,t)||B(e,t)||M()}function M(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(e,t){if(e){if("string"===typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F(e,t):void 0}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function G(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],l=!0,a=!1;try{for(r=r.call(e);!(l=(n=r.next()).done);l=!0)if(i.push(n.value),t&&i.length===t)break}catch(c){a=!0,o=c}finally{try{l||null==r["return"]||r["return"]()}finally{if(a)throw o}}return i}}function U(e){if(Array.isArray(e))return e}var H=Object(l["defineComponent"])({props:{limit:{type:Number,required:!0}},components:{ContentBlock:i["ContentBlock"],Field:P["Field"]},directives:{ContentTable:i["ContentTable"]},data:function(){return{page:0,query:"",isLoading:!0,logWriters:[],selectedLogWriter:"",useRegExp:!1,severities:[{key:"",value:Object(i["translate"])("LogViewer_AnySeverity")},{key:"DEBUG",value:"DEBUG"},{key:"INFO",value:"INFO"},{key:"NOTICE",value:"NOTICE"},{key:"WARNING",value:"WARNING"},{key:"ERROR",value:"ERROR"},{key:"CRITICAL",value:"CRITICAL"},{key:"ALERT",value:"ALERT"},{key:"EMERGENCY",value:"EMERGENCY"}],selectedSeverity:"",logs:void 0,logConfig:void 0}},setup:function(){var e=null,t=function(t){return e&&(e.abort(),e=null),e=new AbortController,i["AjaxHelper"].fetch(Object.assign(Object.assign({},t),{},{method:"LogViewer.getLogEntries"}),{abortController:e,createErrorNotification:!1}).finally((function(){e=null}))};return{getLogEntries:t}},created:function(){var e=this;i["AjaxHelper"].fetch({method:"LogViewer.getAvailableLogReaders"}).then((function(t){Array.isArray(t)&&(e.logWriters=t.map((function(e){return{key:e,value:e}})))})).then((function(){return i["AjaxHelper"].fetch({method:"LogViewer.getConfiguredLogReaders"})})).then((function(t){if(null!==t&&void 0!==t&&t[0]){var r=W(t,1);e.selectedLogWriter=r[0]}else{var n,o=Object(i["translate"])("LogViewer_NoSupportedLogWriterConfiguredTitle"),l=Object(i["translate"])("LogViewer_NoSupportedLogWriterConfiguredMessage",['<a href="https://piwik.org/faq/troubleshooting/faq_115/">',"</a>",e.logWriters.map((function(e){return e.value})).join(", ")]);i["NotificationsStore"].show({message:l,title:o,context:"info",noclear:!0,type:"transient"}),null!==(n=e.logWriters)&&void 0!==n&&n[0]&&(e.selectedLogWriter=e.logWriters[0].value)}e.selectedLogWriter?e.update():e.isLoading=!1})),i["AjaxHelper"].fetch({method:"LogViewer.getLogConfig",filter_limit:"-1"}).then((function(t){e.logConfig=t}))},methods:{update:function(){var e=this;this.isLoading=!0,this.logs=[],this.getLogEntries({query:this.buildQuery,limitPerPage:this.limit,source:this.selectedLogWriter,page:this.page}).catch((function(e){return i["NotificationsStore"].show({message:e.message||e,context:"error",type:"transient"}),[]})).then((function(t){e.logs=t})).finally((function(){e.isLoading=!1}))},searchSeverity:function(e){e&&(this.selectedSeverity=e.toUpperCase(),this.update())},searchDate:function(e){e&&(this.selectedSeverity="",this.query="\\[".concat(e.substr(0,10),".{9}\\]"),this.useRegExp=!0,this.update())},searchRequestId:function(e){e&&this.searchText("[".concat(e,"]"))},searchText:function(e){e&&(this.selectedSeverity="",this.query=e,this.useRegExp&&(this.query=window.preg_quote(this.query)),this.update())},previousPage:function(){this.page>0&&(this.page-=1,this.update())},nextPage:function(){var e;null!==(e=this.logs)&&void 0!==e&&e.length&&(this.page+=1,this.update())},onSearchKeydown:function(e){"Enter"===e.code&&this.update()}},computed:{buildQuery:function(){var e=this.query;return this.useRegExp||(e=window.preg_quote(this.query)),this.selectedSeverity&&(e="^".concat(this.selectedSeverity,"(.*)").concat(e)),e},exportFormAction:function(){return"?".concat(i["MatomoUrl"].stringify({module:"API",method:"LogViewer.getLogEntries",query:this.buildQuery,format:"TSV",page:0,limitPerPage:5e3}))},logConfigJson:function(){return JSON.stringify(this.logConfig||{})},tokenAuth:function(){return i["Matomo"].token_auth},logsWithMessage:function(){return(this.logs||[]).filter((function(e){return e.message}))}}});H.render=I;var J=H;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(i["createAngularJsAdapter"])({component:J,scope:{limit:{angularJsBind:"="}},directiveName:"piwikLogViewer"})}})}));
//# sourceMappingURL=LogViewer.umd.min.js.map